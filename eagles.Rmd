---
title: "Eagles"
author: "Brendan Graham"
date: "May 28, 2016"
output: html_document
---

```{r setup, include=FALSE}
# packages
library(dplyr)
library(ggplot2)
library(nflscrapR)
library(highcharter)
library(rvest)
library(RCurl)
library(stringr)
library(reshape2)
library(purrr)
library(lubridate)
library(xts)
library(knitr)

# load data
season.2015.x <- getURL("https://raw.githubusercontent.com/brndngrhm/eagles/master/season.2015.csv")
season.2015 <- as.data.frame(read.csv(text = season.2015.x, strip.white = T))
phl.x <- getURL("https://raw.githubusercontent.com/brndngrhm/eagles/master/phl.csv")
phl <- as.data.frame(read.csv(text = phl.x, strip.white = T))
eagles.hist.x <- getURL("https://raw.githubusercontent.com/brndngrhm/eagles/master/eagles.hist.csv")
eagles.hist <- as.data.frame(read.csv(text = eagles.hist.x, strip.white = T))
rm(season.2015.x, eagles.hist.x, phl.x)

# global plotting parameters 
hc_params <- highchart() %>%
  hc_chart(zoomType = "x") %>%
  hc_tooltip(crosshairs = TRUE, shared = TRUE, borderWidth = 1, shared=T) %>%
  hc_yAxis(title=" ") %>%
  hc_exporting(enabled = TRUE) %>%
  hc_credits(enabled = TRUE,
             text = "NFL Data from nflscrapR",
             href = "https://github.com/maksimhorowitz/nflscrapR") %>% 
  hc_add_theme(hc_theme_gridlight()) %>%
  hc_legend(enabled = FALSE) %>%
  hc_subtitle(text="2015 Season (Click & Drag to Zoom)", align="left") %>%
  hc_yAxis(title=" ") %>%
  hc_exporting(enabled = TRUE,
               filename = "plot_data")

top.n <- 40          #how many names to show on axis
plot.type <- "bar"   #type of plot
alignment <- "left"  #subtitle alignment

```

Some ideas for gathering and presenting NFL stats for the upcoming season.  
Code available on github [here.](https://github.com/brndngrhm/eagles)  
Data obtained using the *nflscrapR* package. More details on that [here.](https://github.com/maksimhorowitz/nflscrapR)  
Plots done using the *Highcharter* package.  More details on that [here.](http://jkunst.com/highcharter/)

# Eagles {.tabset}
## Offense {.tabset}
### QBs {.tabset}
#### Bradford
```{r, echo=F}
qb <- phl %>% select(name, pass.att, passyds, pass.tds, pass.ints, pass.ints, fumbslost, totalfumbs, rushyds) %>% dplyr::filter(name == "S.Bradford" |  name == "M.Sanchez") %>% arrange(desc(name))
qb$yds.att <- qb$passyds/qb$pass.att
qb <- qb %>% select(name, pass.att, passyds, pass.tds, yds.att, pass.ints, rushyds, totalfumbs, fumbslost)
names(qb)[1] <- "Name"
names(qb)[2] <- "Passing Attempts"
names(qb)[3] <- "Passing Yards"
names(qb)[4] <- "Touchdown Passes"
names(qb)[5] <- "Yards Per Pass"
names(qb)[6] <- "Interceptions"
names(qb)[7] <- "Rushing Yards"
names(qb)[8] <- "Fumbless"
names(qb)[9] <- "Lost Fumbles"
qb.melt <- melt(qb, id.vars = "Name")

(bradford.plot <- hc_params %>%
  hc_add_series(name="Bradford", data = subset(qb.melt$value, qb.melt$Name == "S.Bradford" & qb.melt$variable != "Passing Yards" & qb.melt$variable != "Passing Attempts"), type = plot.type) %>%
  hc_xAxis(categories = subset(qb.melt$variable, qb.melt$Name == "S.Bradford" & qb.melt$variable != "Passing Yards"& qb.melt$variable != "Passing Attempts")) %>%
  hc_title(text = paste("Sam Bradford:",qb.melt[4,3], "Passing Yards,", qb.melt[2,3], "Passing Attempts", by =" "), align = alignment))

knitr::kable(qb, col.names = c("", "Passing Attempts", "Passing Yds", "TD Passes", "Yards/Pass", "Int", "Rushing Yds", "Fumbles", "Lost Fumbles"))
```

#### Sanchez
```{r, echo=F}
(sanchez.plot <- hc_params %>%
  hc_add_series(name="Sanchez", data = subset(qb.melt$value, qb.melt$Name == "M.Sanchez"& qb.melt$variable != "Passing Yards"& qb.melt$variable != "Passing Attempts"), type = plot.type)  %>%
  hc_xAxis(categories = subset(qb.melt$variable, qb.melt$Name == "S.Bradford" & qb.melt$variable != "Passing Yards"& qb.melt$variable != "Passing Attempts")) %>%
  hc_title(text = paste("Mark Sanchez:",qb.melt[3,3], "Passing Yards,", qb.melt[1,3], "Passing Attempts", by =" "), align = alignment))
  
knitr::kable(qb, col.names = c("", "Passing Attempts", "Passing Yds", "TD Passes", "Yards/Pass", "Int", "Rushing Yds", "Fumbles", "Lost Fumbles"))


```



## Defense {.tabset}
## Special Teams {.tabset}
## Time Series Stuff {.tabset}
### Passing Attempts Since 2009
```{r, echo = F}
hist.pass.att <- eagles.hist %>% filter(pass.att > 0) %>% group_by(date, name) %>% summarise(total  = sum(pass.att))
hist.pass.att$date <- ymd(hist.pass.att$date)

bradford.ts <- xts(subset(hist.pass.att$total, hist.pass.att$name == "S.Bradford"), order.by = subset(hist.pass.att$date, hist.pass.att$name == "S.Bradford"), frequency = 52)
vick.ts <- xts(subset(hist.pass.att$total, hist.pass.att$name == "M.Vick"), order.by = subset(hist.pass.att$date, hist.pass.att$name == "M.Vick"), frequency = 52)
foles.ts <- xts(subset(hist.pass.att$total, hist.pass.att$name == "N.Foles"), order.by = subset(hist.pass.att$date, hist.pass.att$name == "N.Foles"), frequency = 52)
sanchez.ts <- xts(subset(hist.pass.att$total, hist.pass.att$name == "M.Sanchez"), order.by = subset(hist.pass.att$date, hist.pass.att$name == "M.Sanchez"), frequency = 52)
barkley.ts <- xts(subset(hist.pass.att$total, hist.pass.att$name == "M.Barkley"), order.by = subset(hist.pass.att$date, hist.pass.att$name == "M.Barkley"), frequency = 52)
smith.ts <- xts(subset(hist.pass.att$total, hist.pass.att$name == "B.Smith"), order.by = subset(hist.pass.att$date, hist.pass.att$name == "B.Smith"), frequency = 52)

highchart(type = "chart") %>% 
  hc_add_series_xts(vick.ts, id = "Vick", name= "Vick") %>%
  hc_add_series_xts(foles.ts, id = "Foles", name = "Foles") %>%
  hc_add_series_xts(barkley.ts, id = "Barkley", name = "Barkley") %>% 
  hc_add_series_xts(smith.ts, id = "Smith", name = "Smith")%>%
  hc_add_series_xts(sanchez.ts, id = "Sanchez", name = "Sanchez") %>%
  hc_add_series_xts(bradford.ts, id = "Bradford", name = "Bradford") %>%
  hc_rangeSelector(inputEnabled = T) %>% 
  hc_scrollbar(enabled = FALSE) %>%
  hc_add_theme(hc_theme_gridlight()) %>% 
  hc_tooltip(crosshairs = TRUE, shared = TRUE, borderWidth = 1, shared=T)%>%
  hc_title(text="Historical Passing Attempts", align="left") %>%
  hc_subtitle(text="2009-2015", align="left") %>%
  hc_yAxis(title=" ") %>%
  hc_exporting(enabled = TRUE) %>%
  hc_credits(enabled = TRUE,
             text = "nflscrapR",
             href = "https://github.com/maksimhorowitz/nflscrapR") %>% 
  hc_add_theme(hc_theme_gridlight()) %>%
  hc_legend(enabled = T)

```

